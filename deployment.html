<!DOCTYPE html>
<html >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

      <title>Distributed deployment</title>
    
          <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="_static/theme.css " type="text/css" />
          <link rel="stylesheet" href="_static/custom.css" type="text/css" />
      
      <!-- sphinx script_files -->
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>

      
      <!-- bundled in js (rollup iife) -->
      <!-- <script src="_static/theme-vendors.js"></script> -->
      <script src="_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="genindex.html" />
  <link rel="search" title="Search" href="search.html" />
  <link rel="next" title="Tutorial: Compute Package" href="tutorial.html" />
  <link rel="prev" title="Architecture overview" href="architecture.html" /> 
  </head>

  <body>
    <div id="app">
    <div class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="index.html" class="home-link">
    
      <img class="logo" src="_static/fedn_logo.webp" alt="logo"/>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="index.html#license">Contents:</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 ">
            
              <a href="index.html" class="reference internal ">Welcome to FEDn documentation</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="architecture.html" class="reference internal ">Architecture overview</a>
            

            
          </li>

        
          <li class="toctree-l1 current">
            
              <a href="#" class="reference internal current">Distributed deployment</a>
            

            
              <ul>
                
                  <li class="toctree-l2"><a href="#prerequisite" class="reference internal">Prerequisite</a></li>
                
                  <li class="toctree-l2"><a href="#deploy-supporting-services-minio-mongodb-and-mongoexpress" class="reference internal">1. Deploy supporting services (MinIO, MongoDB and MongoExpress)</a></li>
                
                  <li class="toctree-l2"><a href="#deploy-the-reducer" class="reference internal">2. Deploy the reducer</a></li>
                
                  <li class="toctree-l2"><a href="#deploy-combiners" class="reference internal">3. Deploy combiners</a></li>
                
                  <li class="toctree-l2"><a href="#attach-clients-to-the-fedn-network" class="reference internal">4. Attach clients to the FEDn network</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="tutorial.html" class="reference internal ">Tutorial: Compute Package</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="releasenotes.html" class="reference internal ">Release Notes</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="sdk.html" class="reference internal ">SDK Documentation</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="faq.html" class="reference internal ">Frequently asked questions</a>
            

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    
    <li>Distributed deployment</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="architecture.html"
       title="previous chapter">← Architecture overview</a>
  </li>
  <li class="next">
    <a href="tutorial.html"
       title="next chapter">Tutorial: Compute Package →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <section id="distributed-deployment">
<h1>Distributed deployment<a class="headerlink" href="#distributed-deployment" title="Permalink to this headline">¶</a></h1>
<p>FEDn is designed for flexibility at the deployment of the FEDn network. By deploying multiple combiners (aggregation servers) at separate hosts/locations,
a user can run highly decentralized networks. However, in the degenerate case of a single active combiner, we obtain a simple central client-server architecture.
The optimal choice of the network topology including the sizing of nodes in the network depends on many factors including the need for redundancy,
the targeted number of clients, the size of the models trained, the need for geographical proximity of clients to combiners, and security considerations.
Since it is easy to scale the network dynamically by attaching additional combiners, we recommend that you start simple and expand the network as needed.</p>
<dl class="simple">
<dt>This example serves as reference deployment for setting up a fully distributed FEDn network consisting of:</dt><dd><ul class="simple">
<li><p>one host serving the supporting services (MinIOs, MongoDB)</p></li>
<li><p>one host serving the controller / reducer</p></li>
<li><p>one host running a combiner</p></li>
</ul>
</dd>
</dl>
<p>We will in this example use the provided docker-compose templates to deploy the components across three different hosts / VMs.
Note that it might be necessary to modify them slightly depending on your target environment and host configurations.</p>
<section id="prerequisite">
<h2>Prerequisite<a class="headerlink" href="#prerequisite" title="Permalink to this headline">¶</a></h2>
<section id="hosts">
<h3>Hosts<a class="headerlink" href="#hosts" title="Permalink to this headline">¶</a></h3>
<p>We assume that you have root access to 3 Ubuntu 20.04 Server hosts / VMs. We recommend at least 4 CPU, 8GB RAM flavors for the base services and the reducer, and 4 CPU, 16BG RAM for the combiner host.
You need to be able to configure security groups / ingress settings for each host.</p>
</section>
<section id="certificates-optional">
<h3>Certificates (optional)<a class="headerlink" href="#certificates-optional" title="Permalink to this headline">¶</a></h3>
<p>Certificates are needed for the reducer and each of the combiners for secure communication.
By default, FEDn will generate unsigned certificates for the reducer and each combiner nodes using OpenSSL.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Certificates based on IP addresses are not supported due to incompatibilities with gRPC.</p>
</div>
</section>
<section id="networking-dns">
<h3>Networking / DNS<a class="headerlink" href="#networking-dns" title="Permalink to this headline">¶</a></h3>
<p>The reducer/controller as well as each client needs to be able to resolve the hostname given in the combiner configuration file. In this example,
we show how this can be achieved if no external DNS lookup is available by setting “extra host” in the Docker containers for the Reducer and client.</p>
</section>
</section>
<section id="deploy-supporting-services-minio-mongodb-and-mongoexpress">
<h2>1. Deploy supporting services (MinIO, MongoDB and MongoExpress)<a class="headerlink" href="#deploy-supporting-services-minio-mongodb-and-mongoexpress" title="Permalink to this headline">¶</a></h2>
<p>First, deploy Minio and Mongo services on one host. Edit ‘config/base-services.yaml’, to change the default passwords.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember to open ports on the host so that the reducer can reach the API endpoints (the exported port in the ‘ports’ properety for each of the services).
Note that you can also configure the reducer to use already existing MongoDB and MinIO backends so this step is optional.</p>
</div>
</section>
<section id="deploy-the-reducer">
<h2>2. Deploy the reducer<a class="headerlink" href="#deploy-the-reducer" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>Follow the steps for pseudo-distributed deployment, but now:</dt><dd><ol class="loweralpha simple">
<li><p>Edit ‘settings-reducer.yaml’ to provide the appropriate connection settings for MongoDB and Minio from Step 1.</p></li>
<li><p>Copy ‘config/extra-hosts-reducer.yaml.template’ to ‘config/extra-hosts-reducer.yaml’ and edit it, adding a host:IP mapping for each combiner you plan to deploy.</p></li>
</ol>
</dd>
</dl>
<p>Then you can start the reducer:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo docker-compose -f config/reducer.yaml -f config/extra-hosts-reducer.yaml up
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Step b is a way to add the host:IP mapping to /etc/hosts in the Docker container in docker-compose. This step can be skipped if you handle this resolution in some other way.</p>
</div>
</section>
<section id="deploy-combiners">
<h2>3. Deploy combiners<a class="headerlink" href="#deploy-combiners" title="Permalink to this headline">¶</a></h2>
<p>Edit ‘config/settings-combiner.yaml’ to provide a name for the combiner (used as a unique identifier for the combiner in the network),
a hostname (which is used by reducer and clients to connect to combiner RPC), and the port (default is 12080, make sure to allow access to this port in your security group/firewall settings). Also, provide the IP and port for the reducer under the ‘controller’ tag. Then deploy the combiner:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo docker-compose -f config/combiner.yaml up
</pre></div>
</div>
<p>Optional: Repeat the same steps for the second combiner node. Make sure to provide unique names for the two combiners.</p>
<p>&gt; Note that it is not currently possible to use the host’s IP address as ‘host’. This is due to gRPC not being able to handle certificates based on IP.</p>
</section>
<section id="attach-clients-to-the-fedn-network">
<h2>4. Attach clients to the FEDn network<a class="headerlink" href="#attach-clients-to-the-fedn-network" title="Permalink to this headline">¶</a></h2>
<p>Once the FEDn network is deployed, you can attach clients to it in the same way as for the pseudo-distributed deployment.
Note that the clients need host:IP resolution for each combiner node in the network. See the reducer deployment for an
example of how you can handle it using docker-compose.</p>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="architecture.html"
       title="previous chapter">← Architecture overview</a>
  </li>
  <li class="next">
    <a href="tutorial.html"
       title="next chapter">Tutorial: Compute Package →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2021, Scaleout Systems AB.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a> 0.8.0.
</div>
            </div>
          </div>
      </page>
    </div></div>
    
    
  </body>
</html>
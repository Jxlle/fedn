<!DOCTYPE html>
<html  lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

      <title>Deployment</title>
    
          <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
          <link rel="stylesheet" href="_static/theme.css " type="text/css" />
          <link rel="stylesheet" href="_static/custom.css" type="text/css" />
      
      <!-- sphinx script_files -->
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>

      
      <!-- bundled in js (rollup iife) -->
      <!-- <script src="_static/theme-vendors.js"></script> -->
      <script src="_static/theme.js" defer></script>
    
  <link rel="index" title="Index" href="genindex.html" />
  <link rel="search" title="Search" href="search.html" />
  <link rel="next" title="Tutorial: Compute Package" href="tutorial.html" />
  <link rel="prev" title="Architecture overview" href="architecture.html" /> 
  </head>

  <body>
    <div id="app">
    <div class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="index.html" class="home-link">
    
      <img class="logo" src="_static/fedn_logo.webp" alt="logo"/>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">Quick search</span>
    <div class="searchformwrapper">
      <form class="search" action="search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="Search" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="index.html#license">Contents:</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 ">
            
              <a href="index.html" class="reference internal ">Welcome to FEDn documentation</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="architecture.html" class="reference internal ">Architecture overview</a>
            

            
          </li>

        
          <li class="toctree-l1 current">
            
              <a href="#" class="reference internal current">Deployment</a>
            

            
              <ul>
                
                  <li class="toctree-l2"><a href="#prerequisites" class="reference internal">Prerequisites</a></li>
                
                  <li class="toctree-l2"><a href="#deploy-base-supporting-services-minio-mongodb-and-mongoexpress" class="reference internal">1. Deploy base/supporting services (MinIO, MongoDB and MongoExpress)</a></li>
                
                  <li class="toctree-l2"><a href="#deploy-the-reducer" class="reference internal">2. Deploy the reducer</a></li>
                
                  <li class="toctree-l2"><a href="#deploy-combiners" class="reference internal">3. Deploy combiners</a></li>
                
                  <li class="toctree-l2"><a href="#attach-clients-to-the-fedn-network" class="reference internal">4. Attach clients to the FEDn network</a></li>
                
              </ul>
            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="tutorial.html" class="reference internal ">Tutorial: Compute Package</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="releasenotes.html" class="reference internal ">Release Notes</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="sdk.html" class="reference internal ">SDK Documentation</a>
            

            
          </li>

        
          <li class="toctree-l1 ">
            
              <a href="faq.html" class="reference internal ">Frequently asked questions</a>
            

            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    
    <li>Deployment</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="architecture.html"
       title="previous chapter">← Architecture overview</a>
  </li>
  <li class="next">
    <a href="tutorial.html"
       title="next chapter">Tutorial: Compute Package →</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main" v-pre>
            
  <section id="deployment">
<h1>Deployment<a class="headerlink" href="#deployment" title="Permalink to this heading">¶</a></h1>
<p>By running multiple combiners (aggregation servers) at separate hosts/locations we can deploy highly decentralized networks. You can choose to deploy combiners
in geographical proximity to optimize for low-latency for client subgroups. In the case of a single combiner, we recover a standard centralized
client-server architecture. Since it is straight-forward to scale the network dynamically by attaching additional combiners, we recommend that you
start simple and expand the network as needed.</p>
<dl class="simple">
<dt>This example serves as reference deployment for setting up a FEDn network consisting of:</dt><dd><ul class="simple">
<li><p>One host/VM serving the supporting services (MinIOs, MongoDB)</p></li>
<li><p>One host/VM serving the controller / reducer</p></li>
<li><p>One host/VM running a combiner</p></li>
</ul>
</dd>
</dl>
<p>We will in this example use the provided docker-compose templates to deploy the components across the three different hosts / VMs.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading">¶</a></h2>
<section id="hosts-vms">
<h3>Hosts / VMs<a class="headerlink" href="#hosts-vms" title="Permalink to this heading">¶</a></h3>
<p>We assume that you have root access to 3 Ubuntu 20.04 Server hosts / VMs. We recommend at least 4 CPUs and 8GB RAM for the base services and the reducer,
and 4 CPUs and 16BG RAM for the combiner host. Each host needs the following:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.docker.com/get-docker">Docker</a></p></li>
<li><p><a class="reference external" href="https://docs.docker.com/compose/install">Docker Compose</a></p></li>
<li><p><a class="reference external" href="https://www.python.org/downloads">Python 3.8</a></p></li>
</ul>
<p>You can use the follwing bash script to install docker and docker-compose for Ubuntu 20.04 LTS:</p>
</section>
<section id="certificates-optional">
<h3>Certificates (optional)<a class="headerlink" href="#certificates-optional" title="Permalink to this heading">¶</a></h3>
<p>Certificates are needed for the Reducer and each of the Combiners to enable SSL for secure communication.
By default, FEDn will generate unsigned certificates for the reducer and each combiner using OpenSSL.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Certificates based on IP addresses are not supported due to incompatibilities with gRPC.</p>
</div>
</section>
<section id="token-authentication-optional">
<h3>Token authentication (optional)<a class="headerlink" href="#token-authentication-optional" title="Permalink to this heading">¶</a></h3>
<p>FEDn supports single token authentication between combiners/clients and the reducer. To enable token authentication use <code class="code docutils literal notranslate"><span class="pre">--secret-key=&lt;your-key-phrase&gt;</span></code> flag when starting the reducer.
The secret key will generate a token (expires after 90 days by default) and display it in the standard output.
Using this configuration will require combiners and clients to authenticate via either <code class="code docutils literal notranslate"><span class="pre">--token=&lt;generated-token&gt;</span></code> or by specifying the “token: &lt;generated-token&gt;” in the settings YAML file provided to <code class="code docutils literal notranslate"><span class="pre">--init</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The instructions below (1-4) does not use token authentication.</p>
</div>
</section>
<section id="networking">
<h3>Networking<a class="headerlink" href="#networking" title="Permalink to this heading">¶</a></h3>
<p>You will also need to be able to configure security groups / ingress settings for each host.
The Reducer as well as each client needs to be able to resolve the hostname for each combiner (matching the certificate). In this example,
we show how this can be achieved if no DNS resolution is available, by setting “extra host” in the Docker containers for the Reducer and client.
Note that there are many other possible ways to achieve this, depending on your setup.</p>
</section>
</section>
<section id="deploy-base-supporting-services-minio-mongodb-and-mongoexpress">
<h2>1. Deploy base/supporting services (MinIO, MongoDB and MongoExpress)<a class="headerlink" href="#deploy-base-supporting-services-minio-mongodb-and-mongoexpress" title="Permalink to this heading">¶</a></h2>
<p>First, use ‘config/base-services.yaml’ to deploy MinIO and Mongo services on one of the hosts. Edit the file to change the default passwords and ports.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo -E docker-compose -f config/base-services.yaml up
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember to open ports on the host so that the API endpoints (the exported port in the ‘ports’ property for each of the services) can be reacheds.
Note that you can also configure the reducer to use already existing MongoDB and MinIO services, in that case you can skip this step.</p>
</div>
</section>
<section id="deploy-the-reducer">
<h2>2. Deploy the reducer<a class="headerlink" href="#deploy-the-reducer" title="Permalink to this heading">¶</a></h2>
<p>Copy the file “config/settings-reducer.yaml.template” to “config/settings-reducer.yaml”, then</p>
<ol class="loweralpha simple">
<li><p>Edit ‘settings-reducer.yaml’ to provide the connection settings for MongoDB and Minio from Step 1.</p></li>
<li><p>Copy ‘config/extra-hosts-reducer.yaml.template’ to ‘config/extra-hosts-reducer.yaml’ and edit it, adding a host:IP mapping for each combiner you plan to deploy.</p></li>
</ol>
<p>Then start the reducer:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo -E docker-compose -f config/reducer.yaml -f config/extra-hosts-reducer.yaml up
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Step b is a way to add the host:IP mapping to /etc/hosts in the Docker container in docker-compose. This step can be skipped if you handle this resolution in some other way.</p>
</div>
</section>
<section id="deploy-combiners">
<h2>3. Deploy combiners<a class="headerlink" href="#deploy-combiners" title="Permalink to this heading">¶</a></h2>
<p>Copy ‘config/settings.yaml.template’ to ‘config/settings-combiner.yaml’ and edit it to provide a name for the combiner (used as a unique identifier for the combiner in the network),
a hostname (which is used by reducer and clients to connect to combiner RPC),
and the port (default is 12080, make sure to allow access to this port in your security group/firewall settings).
Also, provide the IP and port for the reducer under the ‘controller’ tag. Then deploy the combiner:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo -E docker-compose -f config/combiner.yaml up
</pre></div>
</div>
<p>Optional: Repeat this step for any number of additional combiner nodes. Make sure to provide unique names for the two combiners,
and update extra hosts for the reducer.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Note that it is not possible to use the IP address as ‘host’. gRPC does not support certificates based on IP addresses.</p>
</div>
</section>
<section id="attach-clients-to-the-fedn-network">
<h2>4. Attach clients to the FEDn network<a class="headerlink" href="#attach-clients-to-the-fedn-network" title="Permalink to this heading">¶</a></h2>
<p>You can now choose an example, upload a compute package and an initial model, and attach clients.</p>
<ul class="simple">
<li><p><a class="reference external" href="../../examples">Examples</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The clients will also need to be able to resolve the hostname (‘host’ argument) for each combiner node in the network.
There is a template in ‘config/extra-hosts-client.yaml.template’ that can be modified for this purpose.</p>
</div>
</section>
</section>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="architecture.html"
       title="previous chapter">← Architecture overview</a>
  </li>
  <li class="next">
    <a href="tutorial.html"
       title="next chapter">Tutorial: Compute Package →</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; Copyright 2021, Scaleout Systems AB.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.0.2 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a> 0.8.0.
</div>
            </div>
          </div>
      </page>
    </div></div>
    
    
  </body>
</html>